"use strict";(self.webpackChunkcap_webview=self.webpackChunkcap_webview||[]).push([[124],{2124:(et,h,r)=>{r.r(h),r.d(h,{UGPatrolComponent:()=>p,UGPatrolModule:()=>tt,UGPatrolRoutingModule:()=>U});var D=r(7582),P=r(298),f=r(3365),s=r(5313),T=r(2104),_=r(2090),t=r(5879),c=r(6223),u=r(6814),C=r(4630),O=r(3680),d=r(9157),x=r(2032);function b(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"mat-option",3),t.NdJ("click",function(){const a=t.CHM(e).$implicit,m=t.oxw();return t.KtG(m.writeValue(a))}),t._uU(1),t.qZA()}if(2&n){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}let G=(()=>{class n{constructor(){this.label="",this.options=[],this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{}}get opacity(){return this.disabled?.25:1}get value(){return this._value}set value(e){this._value=e}writeValue(e){this._value=e,this.onChange(this.value)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["de-autocomplete"]],hostVars:2,hostBindings:function(o,l){2&o&&t.Udp("opacity",l.opacity)},inputs:{label:"label",options:"options",disabled:"disabled"},features:[t._Bn([{provide:c.JU,useExisting:(0,t.Gpc)(()=>n),multi:!0}])],decls:7,vars:5,consts:[["type","text","matInput","",3,"placeholder","matAutocomplete","ngModel","ngModelChange"],["auto","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"]],template:function(o,l){if(1&o&&(t.TgZ(0,"mat-form-field")(1,"mat-label"),t._uU(2),t.qZA(),t.TgZ(3,"input",0),t.NdJ("ngModelChange",function(m){return l.value=m})("ngModelChange",function(m){return l.writeValue(m)}),t.qZA(),t.TgZ(4,"mat-autocomplete",null,1),t.YNc(6,b,2,2,"mat-option",2),t.qZA()()),2&o){const a=t.MAs(5);t.xp6(2),t.Oqu(l.label),t.xp6(1),t.Q6J("placeholder",l.label)("matAutocomplete",a)("ngModel",l.value),t.xp6(3),t.Q6J("ngForOf",l.options)}},dependencies:[u.sg,c.Fj,c.JJ,c.On,C.XC,O.ey,C.ZL,d.KE,d.hX,x.Nt]})}return n})();var w=r(7917),Z=r(1705),v=r(2436),y=r(2296),F=r(5986),g=r(8034),k=r(617),N=r(8525);function S(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return l.searchText="",t.KtG(l.onFilterChange())}),t.TgZ(1,"mat-icon"),t._uU(2,"close"),t.qZA()()}}function J(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"mat-option",16),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.routeFilter.onSelectionChange())}),t._uU(1),t.qZA()}if(2&n){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function R(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"mat-option",16),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.workTypeFilter.onSelectionChange())}),t._uU(1),t.qZA()}if(2&n){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function E(n,i){if(1&n&&(t.TgZ(0,"mat-header-cell",20),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("ngClass","de-f-justifycenter"),t.xp6(1),t.Oqu("ACTIONS"===e?"":e)}}function Q(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.getPatrolDateStr())}}function K(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const l=t.oxw(2).$implicit,a=t.oxw(2);return t.KtG(a.editRecord(l))}),t._uU(2,"edit"),t.qZA(),t.TgZ(3,"mat-icon",26),t.NdJ("click",function(){t.CHM(e);const l=t.oxw(2).$implicit,a=t.oxw(2);return t.KtG(a.recordToDelete=l)}),t._uU(4,"delete"),t.qZA(),t.BQk()}}function I(n,i){if(1&n&&(t.ynx(0),t.YNc(1,K,5,0,"ng-container",24),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",null==e?null:e.ID)}}function q(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw().$implicit,o=t.oxw().$implicit;t.xp6(1),t.Oqu(e[o])}}function H(n,i){if(1&n&&(t.TgZ(0,"mat-cell",20),t.ynx(1,21),t.YNc(2,Q,2,1,"ng-container",22),t.YNc(3,I,2,1,"ng-container",22),t.YNc(4,q,2,1,"ng-container",23),t.BQk(),t.qZA()),2&n){const e=i.$implicit,o=t.oxw().$implicit,l=t.oxw();t.Q6J("ngClass",l.getCellClassNames(e,o)),t.xp6(1),t.Q6J("ngSwitch",o),t.xp6(1),t.Q6J("ngSwitchCase",null==l.ugPatrolColumns||null==l.ugPatrolColumns.DATE?null:l.ugPatrolColumns.DATE.label),t.xp6(1),t.Q6J("ngSwitchCase","ACTIONS")}}function L(n,i){1&n&&(t.ynx(0,17),t.YNc(1,E,2,2,"mat-header-cell",18),t.YNc(2,H,5,4,"mat-cell",19),t.BQk()),2&n&&t.s9C("matColumnDef",i.$implicit)}function W(n,i){1&n&&t._UZ(0,"mat-header-row")}function Y(n,i){1&n&&t._UZ(0,"mat-row")}function B(n,i){1&n&&(t.TgZ(0,"mat-icon"),t._uU(1,"save"),t.qZA())}function j(n,i){1&n&&t._UZ(0,"de-spinner",41),2&n&&t.Q6J("size",16)}function z(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"de-dialog",27),t.NdJ("closeDialog",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.recordToEdit=null)}),t.ynx(1,28),t._uU(2),t.BQk(),t.ynx(3,29),t._UZ(4,"div",30),t.TgZ(5,"mat-form-field")(6,"mat-label"),t._uU(7),t.qZA(),t.TgZ(8,"input",31),t.NdJ("ngModelChange",function(l){t.CHM(e);const a=t.oxw();return t.KtG(a.recordToEdit.Date=l)}),t.qZA(),t._UZ(9,"mat-datepicker-toggle",32)(10,"mat-datepicker",null,33),t.qZA(),t.TgZ(12,"de-autocomplete",34),t.NdJ("ngModelChange",function(l){t.CHM(e);const a=t.oxw();return t.KtG(a.recordToEdit.Location=l)}),t.qZA(),t.TgZ(13,"de-autocomplete",34),t.NdJ("ngModelChange",function(l){t.CHM(e);const a=t.oxw();return t.KtG(a.recordToEdit.Route=l)}),t.qZA(),t.TgZ(14,"de-autocomplete",34),t.NdJ("ngModelChange",function(l){t.CHM(e);const a=t.oxw();return t.KtG(a.recordToEdit.WorkType=l)}),t.qZA(),t.TgZ(15,"mat-form-field")(16,"mat-label"),t._uU(17),t.qZA(),t.TgZ(18,"input",35),t.NdJ("ngModelChange",function(l){t.CHM(e);const a=t.oxw();return t.KtG(a.recordToEdit.PatrolCount=l)}),t.qZA()(),t.BQk(),t.ynx(19,36),t.TgZ(20,"button",37),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.recordToEdit=null)}),t.TgZ(21,"mat-icon"),t._uU(22,"close"),t.qZA(),t._uU(23),t.qZA(),t.TgZ(24,"button",38),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.updateRecord())}),t.TgZ(25,"div",39),t.YNc(26,B,2,0,"mat-icon",24),t.YNc(27,j,1,1,"de-spinner",40),t.TgZ(28,"span"),t._uU(29),t.qZA()()(),t.BQk(),t.qZA()}if(2&n){const e=t.MAs(11),o=t.oxw();t.xp6(2),t.Oqu(o.recordToEdit.ID?o.TKey.UG_PATROL.EDIT_PATROL:o.TKey.UG_PATROL.ADD_PATROL),t.xp6(5),t.Oqu(o.TKey.COMMON.DATE),t.xp6(1),t.Q6J("matDatepicker",e)("ngModel",o.recordToEdit.Date),t.xp6(1),t.Q6J("for",e),t.xp6(3),t.Q6J("label",o.TKey.COMMON.LOCATION)("ngModel",o.recordToEdit.Location)("options",o.options.location),t.xp6(1),t.Q6J("label",o.TKey.COMMON.ROUTE)("ngModel",o.recordToEdit.Route)("options",o.options.route),t.xp6(1),t.Q6J("label",o.TKey.UG_PATROL.WORK_TYPE)("ngModel",o.recordToEdit.WorkType)("options",o.options.workType),t.xp6(3),t.Oqu(o.TKey.UG_PATROL.PATROL_COUNT),t.xp6(1),t.Q6J("ngModel",o.recordToEdit.PatrolCount),t.xp6(5),t.Oqu(o.TKey.COMMON.CANCEL),t.xp6(3),t.Q6J("ngIf",!o.processingData),t.xp6(1),t.Q6J("ngIf",o.processingData),t.xp6(2),t.Oqu(o.TKey.COMMON.SAVE)}}function $(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"de-confirmation-dialog",42),t.NdJ("onSuccess",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.deleteRecord())})("onCancel",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.recordToDelete=null)}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("title","Delete Patrol?")("content","Are you sure you want to delete patrol '"+e.recordToDelete.Route+"'?")("processing",e.processingData)}}const A=function(){return{standalone:!0}},V=function(){return[25,50,100,20]};class p extends T.H6{constructor(){super(),this.data=new s.by([]),this.fullData=[],this.ugPatrolColumns=this.settingsService.metadata.sheetsInfo?.UG_PATROL?.cols,this.allColumns=[this.ugPatrolColumns?.DATE?.label||"",this.ugPatrolColumns?.LOCATION?.label||"",this.ugPatrolColumns?.ROUTE?.label||"",this.ugPatrolColumns?.WORK_TYPE?.label||"",this.ugPatrolColumns?.PATROL_COUNT?.label||"",this.ugPatrolColumns?.REMARKS?.label||""],this.displayedColumns=[],this.displayedColumnsWithAction=[],this.searchText="",this.workTypeFilter=this.getNewFilterControl([],[]),this.routeFilter=this.getNewFilterControl([],[]),this.recordToEdit=null,this.recordToDelete=null,this.options={location:[],route:[],workType:[]},this.processingData=!1,this.chartOptions={theme:"light2",animationEnabled:!0,zoomEnabled:!0,title:{text:this.TKey.COMMON.UG_PATROL},data:[{type:"line",xValueFormatString:"DD MMM'YY",yValueFormatString:"#",dataPoints:[]}]},console.log(this),this.filterRoute=this.filterRoute.bind(this),this.filterWorkType=this.filterWorkType.bind(this),this._subscriptions.push(this.eventService.isMobile.subscribe(()=>this.refreshDisplayedColumns())),this.settingsService.pageTitle=this.TKey.COMMON.UG_PATROL}ngOnInit(){this._subscriptions.push(this.eventService.isMobile.subscribe(()=>this.refreshDisplayedColumns())),this.settingsService.pageTitle=this.TKey.COMMON.UG_PATROL}ngAfterViewInit(){this.data.paginator=this.paginator,this.refreshData()}refreshDisplayedColumns(){this.displayedColumns=this.allColumns.slice(0,this.settingsService.isMobile?5:6),this.displayedColumnsWithAction=[...this.displayedColumns,"ACTIONS"]}refreshData(){this.apiGSheetDataService.getSheetData(this.settingsService.metadata.sheetsInfo?.UG_PATROL.label,_.zF,!0).subscribe({next:i=>{this.fullData=i,this.options.location=Object.keys(this.fullData.reduce((e,o)=>(e[o.Location]=!0,e),{})),this.options.route=Object.keys(this.fullData.reduce((e,o)=>(e[o.Route]=!0,e),{})),this.options.workType=Object.keys(this.fullData.reduce((e,o)=>(e[o.WorkType]=!0,e),{})),this.initializeFilters(),this.recordToEdit=null,this.recordToDelete=null,this.processingData=!1},error:i=>this.utilService.openSnackBar(`ERROR IN FETCHING DATA: ${i}`,"Close")})}createRecord(){this.recordToEdit=new _.zF({Date:new Date,PatrolCount:1})}editRecord(i){this.recordToEdit=i.clone()}updateRecord(){if(!this.recordToEdit)return;this.processingData=!0;const i=this.recordToEdit.clone();i.ID=i.ID||Date.now().toString(),i.Date=_.gq.formatDate(i.Date),this.apiGSheetDataService.saveOrUpdateRecord(this.settingsService.metadata.sheetsInfo?.UG_PATROL?.label,[this.ugPatrolColumns?.ID?.label],i).subscribe({next:()=>this.refreshData(),error:e=>{this.processingData=!1,this.utilService.openSnackBar(e,"Close")}})}deleteRecord(){this.processingData=!0,this.apiGSheetDataService.deleteRecord(this.settingsService.metadata.sheetsInfo?.UG_PATROL?.label,[this.ugPatrolColumns?.ID?.label],this.recordToDelete).subscribe({next:()=>this.refreshData(),error:i=>{this.processingData=!1,this.utilService.openSnackBar(i,"Close")}})}initializeFilters(){const i={},e={};this.fullData.forEach(o=>{i[o.Route]=!0,e[o.WorkType]=!0}),this.routeFilter.controlOptions=Object.keys(i),this.routeFilter.controlOptions.sort(),this.routeFilter.control.setValue([]),this.routeFilter.selectAll=!1,this.workTypeFilter.controlOptions=Object.keys(e),this.workTypeFilter.controlOptions.sort(),this.workTypeFilter.control.setValue([]),this.workTypeFilter.selectAll=!1,this.onFilterChange()}onFilterChange(){const i=a=>!0;let e=this.filterRoute,o=this.filterWorkType,l=this.filterSearch;this.routeFilter._selectedObj={},(this.routeFilter.control.value||[]).forEach(a=>this.routeFilter._selectedObj[a]=!0),this.workTypeFilter._selectedObj={},(this.workTypeFilter.control.value||[]).forEach(a=>this.workTypeFilter._selectedObj[a]=!0),(!this.routeFilter.control.value?.length||(this.routeFilter.control?.value||[]).length===this.routeFilter.controlOptions?.length)&&(e=i),(!this.workTypeFilter.control.value?.length||(this.workTypeFilter.control?.value||[]).length===this.workTypeFilter.controlOptions?.length)&&(o=i),this.searchText||(l=i),this.data.data=this.fullData.filter(e).filter(o).filter(l)}filterSearch(i){return i.freeTextSearch(this.searchText)}filterRoute(i){return this.routeFilter._selectedObj[i.Route]}filterWorkType(i){return this.routeFilter._selectedObj[i.WorkType]}getCellClassNames(i,e){return e===this.ugPatrolColumns?.DATE?.label||e===this.ugPatrolColumns?.PATROL_COUNT?.label||"ACTIONS"===e?"align-center":""}static#t=this.\u0275fac=function(e){return new(e||p)};static#e=this.\u0275cmp=t.Xpm({type:p,selectors:[["de-ug-patrol"]],viewQuery:function(e,o){if(1&e&&t.Gf(f.NW,5),2&e){let l;t.iGM(l=t.CRH())&&(o.paginator=l.first)}},features:[t.qOj],decls:33,vars:25,consts:[[1,"filter-row","de-p-vbase"],["matInput","","type","text",3,"ngModel","ngModelChange"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],["multiple","",3,"formControl"],[1,"select-all"],[3,"ngModel","ngModelOptions","ngModelChange","change"],[3,"value","click",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click"],[1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],[4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["pageSize","50","showFirstLastButtons","",3,"pageSizeOptions"],["classNames","min-w360",3,"closeDialog",4,"ngIf"],[3,"title","content","processing","onSuccess","onCancel",4,"ngIf"],["matSuffix","","mat-icon-button","",3,"click"],[3,"value","click"],[3,"matColumnDef"],[3,"ngClass",4,"matHeaderCellDef"],[3,"ngClass",4,"matCellDef"],[3,"ngClass"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[4,"ngIf"],["color","primary",1,"de-cursorpointer","de-m-rbase",3,"click"],["color","warn",1,"de-cursorpointer",3,"click"],["classNames","min-w360",3,"closeDialog"],["de-dialog-header",""],["de-dialog-body",""],[1,"de-p-vbase"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matIconSuffix","",3,"for"],["picker",""],[3,"label","ngModel","options","ngModelChange"],["matInput","","type","number",3,"ngModel","ngModelChange"],["de-dialog-footer",""],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"de-f-aligncenter","de-sm-rsmall-nolast"],["color","white",3,"size",4,"ngIf"],["color","white",3,"size"],[3,"title","content","processing","onSuccess","onCancel"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field")(2,"mat-label"),t._uU(3),t.qZA(),t.TgZ(4,"input",1),t.NdJ("ngModelChange",function(a){return o.searchText=a})("ngModelChange",function(){return o.onFilterChange()}),t.qZA(),t.YNc(5,S,3,0,"button",2),t.qZA(),t.TgZ(6,"mat-form-field")(7,"mat-label"),t._uU(8),t.qZA(),t.TgZ(9,"mat-select",3)(10,"div",4)(11,"mat-checkbox",5),t.NdJ("ngModelChange",function(a){return o.routeFilter.selectAll=a})("change",function(){return o.routeFilter.toggleSelectAll()}),t._uU(12,"Select All"),t.qZA()(),t.YNc(13,J,2,2,"mat-option",6),t.qZA()(),t.TgZ(14,"mat-form-field")(15,"mat-label"),t._uU(16),t.qZA(),t.TgZ(17,"mat-select",3)(18,"div",4)(19,"mat-checkbox",5),t.NdJ("ngModelChange",function(a){return o.workTypeFilter.selectAll=a})("change",function(){return o.workTypeFilter.toggleSelectAll()}),t._uU(20,"Select All"),t.qZA()(),t.YNc(21,R,2,2,"mat-option",6),t.qZA()(),t.TgZ(22,"button",7),t.NdJ("click",function(){return o.createRecord()}),t.TgZ(23,"mat-icon"),t._uU(24,"add"),t.qZA(),t._uU(25),t.qZA()(),t.TgZ(26,"mat-table",8),t.YNc(27,L,3,1,"ng-container",9),t.YNc(28,W,1,0,"mat-header-row",10),t.YNc(29,Y,1,0,"mat-row",11),t.qZA(),t._UZ(30,"mat-paginator",12),t.YNc(31,z,30,20,"de-dialog",13),t.YNc(32,$,1,3,"de-confirmation-dialog",14)),2&e&&(t.xp6(3),t.Oqu(o.TKey.COMMON.SEARCH),t.xp6(1),t.Q6J("ngModel",o.searchText),t.xp6(1),t.Q6J("ngIf",o.searchText),t.xp6(3),t.Oqu(o.TKey.COMMON.ROUTE),t.xp6(1),t.Q6J("formControl",o.routeFilter.control),t.xp6(2),t.Q6J("ngModel",o.routeFilter.selectAll)("ngModelOptions",t.DdM(22,A)),t.xp6(2),t.Q6J("ngForOf",o.routeFilter.controlOptions),t.xp6(3),t.Oqu(o.TKey.UG_PATROL.WORK_TYPE),t.xp6(1),t.Q6J("formControl",o.workTypeFilter.control),t.xp6(2),t.Q6J("ngModel",o.workTypeFilter.selectAll)("ngModelOptions",t.DdM(23,A)),t.xp6(2),t.Q6J("ngForOf",o.workTypeFilter.controlOptions),t.xp6(4),t.Oqu(o.TKey.COMMON.ADD),t.xp6(1),t.Q6J("dataSource",o.data),t.xp6(1),t.Q6J("ngForOf",o.displayedColumnsWithAction),t.xp6(1),t.Q6J("matHeaderRowDef",o.displayedColumnsWithAction)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumnsWithAction),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(24,V)),t.xp6(1),t.Q6J("ngIf",o.recordToEdit),t.xp6(1),t.Q6J("ngIf",o.recordToDelete))},dependencies:[G,w.z,Z.a,v.O,u.mk,u.sg,u.O5,u.RF,u.n9,u.ED,c.Fj,c.wV,c.JJ,c.On,c.oH,O.ey,y.lW,y.RK,F.oG,g.Mq,g.hl,g.nW,d.KE,d.hX,d.R9,k.Hw,x.Nt,f.NW,N.gD,s.BZ,s.fO,s.as,s.w1,s.Dz,s.nj,s.ge,s.ev,s.XQ,s.Gk],styles:["[_nghost-%COMP%]{display:block;padding:12px;height:100%;width:100%}","mat-table[_ngcontent-%COMP%]     mat-header-row mat-header-cell:last-child, mat-table[_ngcontent-%COMP%]     mat-row mat-cell:last-child{max-width:90px;min-width:90px}"]})}(0,D.gn)([(0,P.Ds)(500)],p.prototype,"onFilterChange",null);var M=r(1896);const X=[{path:"",component:p},{path:"**",redirectTo:""}];let U=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[M.Bz.forChild(X),M.Bz]})}return n})();r(7271);let tt=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[T.nC.forChild(),U]})}return n})()}}]);