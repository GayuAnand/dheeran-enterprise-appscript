"use strict";(self.webpackChunkcap_webview=self.webpackChunkcap_webview||[]).push([[359],{8359:(Se,b,a)=>{a.r(b),a.d(b,{UGPatrolComponent:()=>m,UGPatrolModule:()=>Ee,UGPatrolRoutingModule:()=>K,UGPatrolStatisticsComponent:()=>J});var E=a(7582),O=a(6328),U=a(7398),u=a(3566),S=a(298),T=a(3365),s=a(5313),C=a(2300),g=a(7848),e=a(5879),c=a(6223),_=a(6814),k=a(4630),f=a(3680),d=a(9157),A=a(2032);function P(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",3),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.writeValue(r))}),e._uU(1),e.qZA()}if(2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}let N=(()=>{class i{constructor(){this.label="",this.options=[],this.disabled=!1,this.onChange=t=>{},this.onTouched=()=>{}}get opacity(){return this.disabled?.25:1}get value(){return this._value}set value(t){this._value=t}writeValue(t){this._value=t,this.onChange(this.value)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["de-autocomplete"]],hostVars:2,hostBindings:function(o,n){2&o&&e.Udp("opacity",n.opacity)},inputs:{label:"label",options:"options",disabled:"disabled"},features:[e._Bn([{provide:c.JU,useExisting:(0,e.Gpc)(()=>i),multi:!0}])],decls:7,vars:5,consts:[["type","text","matInput","",3,"placeholder","matAutocomplete","ngModel","ngModelChange"],["auto","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"]],template:function(o,n){if(1&o&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"input",0),e.NdJ("ngModelChange",function(p){return n.value=p})("ngModelChange",function(p){return n.writeValue(p)}),e.qZA(),e.TgZ(4,"mat-autocomplete",null,1),e.YNc(6,P,2,2,"mat-option",2),e.qZA()()),2&o){const r=e.MAs(5);e.xp6(2),e.Oqu(n.label),e.xp6(1),e.Q6J("placeholder",n.label)("matAutocomplete",r)("ngModel",n.value),e.xp6(3),e.Q6J("ngForOf",n.options)}},dependencies:[_.sg,c.Fj,c.JJ,c.On,k.XC,f.ey,k.ZL,d.KE,d.hX,A.Nt]})}return i})();var F=a(7917),v=a(1705),Z=a(3969),x=a(2296),w=a(5986),G=a(8034),D=a(617),y=a(8525);function L(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return n.searchText="",e.KtG(n.onFilterChange())}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function W(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.routeFilter.onSelectionChange())}),e._uU(1),e.qZA()}if(2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Q(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.workTypeFilter.onSelectionChange())}),e._uU(1),e.qZA()}if(2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function H(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.createRecord())}),e.TgZ(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e._uU(3),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(t.TKey.COMMON.ADD)}}function B(i,l){if(1&i&&(e.TgZ(0,"mat-header-cell",22),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("ngClass","de-f-justifycenter"),e.xp6(1),e.Oqu("ACTIONS"===t?"":t)}}function Y(i,l){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.getPatrolDateStr())}}function j(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-icon",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.editRecord(n))}),e._uU(2,"edit"),e.qZA(),e.TgZ(3,"mat-icon",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.recordToDelete=n)}),e._uU(4,"delete"),e.qZA(),e.BQk()}}function $(i,l){if(1&i&&(e.ynx(0),e.YNc(1,j,5,0,"ng-container",27),e.BQk()),2&i){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",(null==t?null:t.ID)&&(o.authService.isUGAdmin()||o.isRecordByLoggedInUser(t)))}}function z(i,l){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.Oqu(t[o])}}function V(i,l){if(1&i&&(e.TgZ(0,"mat-cell",23),e.ynx(1,24),e.YNc(2,Y,2,1,"ng-container",25),e.YNc(3,$,2,1,"ng-container",25),e.YNc(4,z,2,1,"ng-container",26),e.BQk(),e.qZA()),2&i){const t=l.$implicit,o=e.oxw().$implicit,n=e.oxw();e.Q6J("ngClass",n.getCellClassNames(t,o)),e.xp6(1),e.Q6J("ngSwitch",o),e.xp6(1),e.Q6J("ngSwitchCase",null==n.ugPatrolColumns||null==n.ugPatrolColumns.DATE?null:n.ugPatrolColumns.DATE.label),e.xp6(1),e.Q6J("ngSwitchCase","ACTIONS")}}function X(i,l){1&i&&(e.ynx(0,19),e.YNc(1,B,2,2,"mat-header-cell",20),e.YNc(2,V,5,4,"mat-cell",21),e.BQk()),2&i&&e.s9C("matColumnDef",l.$implicit)}function ee(i,l){1&i&&e._UZ(0,"mat-header-row")}function te(i,l){1&i&&e._UZ(0,"mat-row")}function oe(i,l){if(1&i&&(e.TgZ(0,"mat-option",46),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function ne(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"de-dialog",30),e.NdJ("closeDialog",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.recordToEdit=null)}),e.ynx(1,31),e._uU(2),e.BQk(),e.ynx(3,32),e._UZ(4,"div",33),e.TgZ(5,"mat-form-field")(6,"mat-label"),e._uU(7),e.qZA(),e.TgZ(8,"input",34),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Date=n)}),e.qZA(),e._UZ(9,"mat-datepicker-toggle",35)(10,"mat-datepicker",null,36),e.qZA(),e.TgZ(12,"de-autocomplete",37),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Location=n)}),e.qZA(),e.TgZ(13,"de-autocomplete",37),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Route=n)}),e.qZA(),e.TgZ(14,"mat-form-field")(15,"mat-label"),e._uU(16),e.qZA(),e.TgZ(17,"mat-select",38),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.WorkType=n)}),e.YNc(18,oe,2,2,"mat-option",39),e.qZA()(),e.TgZ(19,"mat-form-field")(20,"mat-label"),e._uU(21),e.qZA(),e.TgZ(22,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.PatrolCount=n)}),e.qZA()(),e.TgZ(23,"mat-form-field")(24,"mat-label"),e._uU(25),e.qZA(),e.TgZ(26,"textarea",41),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Remarks=n)}),e.qZA()(),e.BQk(),e.ynx(27,42),e.TgZ(28,"button",43),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.recordToEdit=null)}),e.TgZ(29,"mat-icon"),e._uU(30,"close"),e.qZA(),e._uU(31),e.qZA(),e.TgZ(32,"button",44),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.updateRecord())}),e.TgZ(33,"div",45)(34,"mat-icon"),e._uU(35,"save"),e.qZA(),e.TgZ(36,"span"),e._uU(37),e.qZA()()(),e.BQk(),e.qZA()}if(2&i){const t=e.MAs(11),o=e.oxw();e.xp6(2),e.Oqu(o.recordToEdit.ID?o.TKey.UG.EDIT_PATROL:o.TKey.UG.ADD_PATROL),e.xp6(5),e.Oqu(o.TKey.COMMON.DATE),e.xp6(1),e.Q6J("matDatepicker",t)("ngModel",o.recordToEdit.Date),e.xp6(1),e.Q6J("for",t),e.xp6(3),e.Q6J("label",o.TKey.COMMON.LOCATION)("ngModel",o.recordToEdit.Location)("options",o.options.location),e.xp6(1),e.Q6J("label",o.TKey.COMMON.ROUTE)("ngModel",o.recordToEdit.Route)("options",o.options.route),e.xp6(3),e.Oqu(o.TKey.UG.WORK_TYPE),e.xp6(1),e.Q6J("ngModel",o.recordToEdit.WorkType),e.xp6(1),e.Q6J("ngForOf",o.settingsService.metadata.ugWorkType),e.xp6(3),e.Oqu(o.TKey.UG.PATROL_COUNT),e.xp6(1),e.Q6J("ngModel",o.recordToEdit.PatrolCount),e.xp6(3),e.Oqu(o.TKey.COMMON.REMARKS),e.xp6(1),e.Q6J("ngModel",o.recordToEdit.Remarks),e.xp6(5),e.Oqu(o.TKey.COMMON.CANCEL),e.xp6(6),e.Oqu(o.TKey.COMMON.SAVE)}}function ie(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"de-confirmation-dialog",47),e.NdJ("onSuccess",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.deleteRecord())})("onCancel",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.recordToDelete=null)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("title","Delete Patrol?")("content","Are you sure you want to delete patrol '"+t.recordToDelete.Route+"'?")}}const q=function(){return{standalone:!0}},le=function(){return[25,50,100,150]};class m extends C.H6{constructor(){super(),this.data=new s.by([]),this.fullData=[],this.ugPatrolColumns=this.settingsService.metadata.sheetsInfo?.UG_PATROL?.cols,this.allColumns=[this.ugPatrolColumns?.DATE?.label||"",this.ugPatrolColumns?.BY?.label||"",this.ugPatrolColumns?.LOCATION?.label||"",this.ugPatrolColumns?.ROUTE?.label||"",this.ugPatrolColumns?.WORK_TYPE?.label||"",this.ugPatrolColumns?.PATROL_COUNT?.label||"",this.ugPatrolColumns?.REMARKS?.label||""],this.displayedColumns=[],this.displayedColumnsWithAction=[],this.searchText="",this.searchTextRegexp=new RegExp(""),this.workTypeFilter=this.getNewFilterControl([],[]),this.routeFilter=this.getNewFilterControl([],[]),this.recordToEdit=null,this.recordToDelete=null,this.options={location:[],route:[],workType:[]},this.cacheInfo=null,this.filterRoute=this.filterRoute.bind(this),this.filterSearch=this.filterSearch.bind(this),this.filterWorkType=this.filterWorkType.bind(this),this._subscriptions.push(this.eventService.isMobile.subscribe(()=>this.refreshDisplayedColumns())),this.settingsService.pageTitle=this.TKey.UG.PATROL_LIST}ngOnInit(){this._subscriptions.push(this.eventService.isMobile.subscribe(()=>this.refreshDisplayedColumns()))}ngAfterViewInit(){this.data.sort=this.sort,this.data.paginator=this.paginator,this.refreshData()}refreshDisplayedColumns(){this.displayedColumns=this.allColumns.slice(0,this.settingsService.isMobile?4:7),this.displayedColumnsWithAction=[...this.displayedColumns,"ACTIONS"]}refreshData(l=!1){this.settingsService.processingText="Refreshing data...",this.apiGSheetDataService.getSheetData(this.settingsService.metadata.sheetsInfo?.UG_PATROL.label,g.zF,l).pipe((0,O.b)(t=>this.getRefreshCacheInfo(`SHEET_${this.settingsService.metadata.sheetsInfo?.UG_PATROL.label}`,this.cacheInfo).pipe((0,U.U)(o=>(this.cacheInfo=o,t))))).subscribe({next:t=>{this.fullData=t,this.options.location=Object.keys(this.fullData.reduce((o,n)=>(o[n.Location]=!0,o),{})),this.options.route=Object.keys(this.fullData.reduce((o,n)=>(o[n.Route]=!0,o),{})),this.options.workType=this.settingsService.metadata.ugWorkType,this.options.location.sort(),this.options.route.sort(),this.options.workType.sort(),this.initializeFilters()},error:t=>this.utilService.openErrorSnackBar(`ERROR IN FETCHING DATA: ${t}`,"Close"),complete:()=>{this.recordToEdit=null,this.recordToDelete=null,this.settingsService.processingText=""}})}createRecord(){this.recordToEdit=new g.zF({Date:new Date,PatrolCount:1})}editRecord(l){this.recordToEdit=l.clone()}updateRecord(){if(!this.recordToEdit)return;this.settingsService.processingText="Updating data...";const l=this.recordToEdit.clone(),t=!l.ID;l.ID=l.ID||Date.now().toString(),l.Date=g.gq.formatDate(l.Date),t&&(l.By=this.authService.Username),this.apiGSheetDataService.saveOrUpdateRecord(this.settingsService.metadata.sheetsInfo?.UG_PATROL?.label,[this.ugPatrolColumns?.ID?.label],l).subscribe({next:()=>{this.settingsService.processingText="",this.refreshData(!0)},error:o=>{this.settingsService.processingText="",this.utilService.openErrorSnackBar(o,"Close")}})}deleteRecord(){this.settingsService.processingText="Deleting record...",this.apiGSheetDataService.deleteRecord(this.settingsService.metadata.sheetsInfo?.UG_PATROL?.label,[this.ugPatrolColumns?.ID?.label],this.recordToDelete).subscribe({next:()=>{this.settingsService.processingText="",this.refreshData(!0)},error:l=>{this.settingsService.processingText="",this.utilService.openErrorSnackBar(l,"Close")}})}initializeFilters(){const l={},t={};this.fullData.forEach(o=>{l[o.Route]=!0,t[o.WorkType]=!0}),this.routeFilter.controlOptions=Object.keys(l),this.routeFilter.controlOptions.sort(),this.routeFilter.control.setValue([]),this.routeFilter.selectAll=!1,this.workTypeFilter.controlOptions=Object.keys(t),this.workTypeFilter.controlOptions.sort(),this.workTypeFilter.control.setValue([]),this.workTypeFilter.selectAll=!1,this.onFilterChange()}onFilterChange(){const l=r=>!0;let t=this.filterRoute,o=this.filterWorkType,n=this.filterSearch;this.routeFilter._selectedObj={},(this.routeFilter.control.value||[]).forEach(r=>this.routeFilter._selectedObj[r]=!0),this.workTypeFilter._selectedObj={},(this.workTypeFilter.control.value||[]).forEach(r=>this.workTypeFilter._selectedObj[r]=!0),(!this.routeFilter.control.value?.length||(this.routeFilter.control?.value||[]).length===this.routeFilter.controlOptions?.length)&&(t=l),(!this.workTypeFilter.control.value?.length||(this.workTypeFilter.control?.value||[]).length===this.workTypeFilter.controlOptions?.length)&&(o=l),this.searchText?this.searchTextRegexp=this.utilService.getFlexibleSearchTextRegexp(this.searchText):n=l,this.data.data=this.fullData.filter(t).filter(o).filter(n)}filterSearch(l){return l.freeTextSearch(this.searchTextRegexp)}filterRoute(l){return this.routeFilter._selectedObj[l.Route]}filterWorkType(l){return this.routeFilter._selectedObj[l.WorkType]}getCellClassNames(l,t){return t===this.ugPatrolColumns?.DATE?.label||t===this.ugPatrolColumns?.PATROL_COUNT?.label||"ACTIONS"===t?"align-center":""}isRecordByLoggedInUser(l){return l.By===this.authService.Username}static#e=this.\u0275fac=function(t){return new(t||m)};static#t=this.\u0275cmp=e.Xpm({type:m,selectors:[["de-ug-patrol-list"]],viewQuery:function(t,o){if(1&t&&(e.Gf(u.YE,5),e.Gf(T.NW,5)),2&t){let n;e.iGM(n=e.CRH())&&(o.sort=n.first),e.iGM(n=e.CRH())&&(o.paginator=n.first)}},features:[e.qOj],decls:31,vars:26,consts:[[1,"filter-row","de-p-vbase"],["matInput","","type","text",3,"ngModel","ngModelChange"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],["multiple","",3,"formControl"],[1,"select-all"],[3,"ngModel","ngModelOptions","ngModelChange","change"],[3,"value","click",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"de-m-bbase",3,"cacheInfo","refresh"],["matSort","","matSortActive","Date","matSortDirection","desc",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],[4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["pageSize","50","showFirstLastButtons","",3,"pageSizeOptions"],["classNames","min-w300",3,"closeDialog",4,"ngIf"],[3,"title","content","onSuccess","onCancel",4,"ngIf"],["matSuffix","","mat-icon-button","",3,"click"],[3,"value","click"],["mat-raised-button","","color","accent",3,"click"],[3,"matColumnDef"],["mat-sort-header","",3,"ngClass",4,"matHeaderCellDef"],[3,"ngClass",4,"matCellDef"],["mat-sort-header","",3,"ngClass"],[3,"ngClass"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[4,"ngIf"],["color","primary",1,"de-cursorpointer","de-m-rbase",3,"click"],["color","warn",1,"de-cursorpointer",3,"click"],["classNames","min-w300",3,"closeDialog"],["de-dialog-header",""],["de-dialog-body",""],[1,"de-p-vbase"],["matInput","",3,"matDatepicker","ngModel","ngModelChange"],["matIconSuffix","",3,"for"],["picker",""],[3,"label","ngModel","options","ngModelChange"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number",3,"ngModel","ngModelChange"],["matInput","",3,"ngModel","ngModelChange"],["de-dialog-footer",""],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"de-f-aligncenter","de-sm-rsmall-nolast"],[3,"value"],[3,"title","content","onSuccess","onCancel"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-form-field")(2,"mat-label"),e._uU(3),e.qZA(),e.TgZ(4,"input",1),e.NdJ("ngModelChange",function(r){return o.searchText=r})("ngModelChange",function(){return o.onFilterChange()}),e.qZA(),e.YNc(5,L,3,0,"button",2),e.qZA(),e.TgZ(6,"mat-form-field")(7,"mat-label"),e._uU(8),e.qZA(),e.TgZ(9,"mat-select",3)(10,"div",4)(11,"mat-checkbox",5),e.NdJ("ngModelChange",function(r){return o.routeFilter.selectAll=r})("change",function(){return o.routeFilter.toggleSelectAll()}),e._uU(12,"Select All"),e.qZA()(),e.YNc(13,W,2,2,"mat-option",6),e.qZA()(),e.TgZ(14,"mat-form-field")(15,"mat-label"),e._uU(16),e.qZA(),e.TgZ(17,"mat-select",3)(18,"div",4)(19,"mat-checkbox",5),e.NdJ("ngModelChange",function(r){return o.workTypeFilter.selectAll=r})("change",function(){return o.workTypeFilter.toggleSelectAll()}),e._uU(20,"Select All"),e.qZA()(),e.YNc(21,Q,2,2,"mat-option",6),e.qZA()(),e.YNc(22,H,4,1,"button",7),e.qZA(),e.TgZ(23,"de-refresh-data",8),e.NdJ("refresh",function(){return o.refreshData(!0)}),e.qZA(),e.TgZ(24,"mat-table",9),e.YNc(25,X,3,1,"ng-container",10),e.YNc(26,ee,1,0,"mat-header-row",11),e.YNc(27,te,1,0,"mat-row",12),e.qZA(),e._UZ(28,"mat-paginator",13),e.YNc(29,ne,38,20,"de-dialog",14),e.YNc(30,ie,1,2,"de-confirmation-dialog",15)),2&t&&(e.xp6(3),e.Oqu(o.TKey.COMMON.SEARCH),e.xp6(1),e.Q6J("ngModel",o.searchText),e.xp6(1),e.Q6J("ngIf",o.searchText),e.xp6(3),e.Oqu(o.TKey.COMMON.ROUTE),e.xp6(1),e.Q6J("formControl",o.routeFilter.control),e.xp6(2),e.Q6J("ngModel",o.routeFilter.selectAll)("ngModelOptions",e.DdM(23,q)),e.xp6(2),e.Q6J("ngForOf",o.routeFilter.controlOptions),e.xp6(3),e.Oqu(o.TKey.UG.WORK_TYPE),e.xp6(1),e.Q6J("formControl",o.workTypeFilter.control),e.xp6(2),e.Q6J("ngModel",o.workTypeFilter.selectAll)("ngModelOptions",e.DdM(24,q)),e.xp6(2),e.Q6J("ngForOf",o.workTypeFilter.controlOptions),e.xp6(1),e.Q6J("ngIf",o.settingsService.isOnline),e.xp6(1),e.Q6J("cacheInfo",o.cacheInfo),e.xp6(1),e.Q6J("dataSource",o.data),e.xp6(1),e.Q6J("ngForOf",o.displayedColumnsWithAction),e.xp6(1),e.Q6J("matHeaderRowDef",o.displayedColumnsWithAction)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumnsWithAction),e.xp6(1),e.Q6J("pageSizeOptions",e.DdM(25,le)),e.xp6(1),e.Q6J("ngIf",o.recordToEdit),e.xp6(1),e.Q6J("ngIf",o.recordToDelete))},dependencies:[N,F.z,v.a,Z.s,_.mk,_.sg,_.O5,_.RF,_.n9,_.ED,c.Fj,c.wV,c.JJ,c.On,c.oH,f.ey,x.lW,x.RK,w.oG,G.Mq,G.hl,G.nW,d.KE,d.hX,d.R9,D.Hw,A.Nt,u.YE,u.nU,T.NW,y.gD,s.BZ,s.fO,s.as,s.w1,s.Dz,s.nj,s.ge,s.ev,s.XQ,s.Gk],styles:["[_nghost-%COMP%]{display:block;padding:12px;height:100%;width:100%}","mat-table[_ngcontent-%COMP%]     mat-header-row mat-header-cell:last-child, mat-table[_ngcontent-%COMP%]     mat-row mat-cell:last-child{max-width:90px;min-width:90px}.select-all[_ngcontent-%COMP%]{padding:6px}th.mat-sort-header-sorted[_ngcontent-%COMP%]{color:#000}"]})}(0,E.gn)([(0,S.Ds)(500)],m.prototype,"onFilterChange",null);var re=a(4612);const ae=function(){return{width:"100%",height:"100%"}};let J=(()=>{class i extends C.H6{constructor(){super(),this.fullData=[],this.cacheInfo=null,this.chartType="line",this.chartOptions={animationEnabled:!0,exportEnabled:!0,zoomEnabled:!0,zoomType:"x",title:{text:""},axisX:{title:"",labelFormatter:t=>this.utilService.formatDate(t.label,"DD-MMM-YYYY"),labelFontSize:14},axisY:{title:"",gridDashType:"dash",labelFontSize:14},toolTip:{shared:!0},legend:{cursor:"pointer",itemclick:t=>{t.dataSeries.visible=!(typeof t.dataSeries.visible>"u"||t.dataSeries.visible),t.chart.render()},fontSize:16},data:[]},this.settingsService.pageTitle=this.TKey.COMMON.UG}ngOnInit(){}ngAfterViewInit(){this.refreshData()}refreshData(t=!1){this.settingsService.processingText="Refreshing data...",this.apiGSheetDataService.getSheetData(this.settingsService.metadata.sheetsInfo?.UG_PATROL.label,g.zF,t).pipe((0,O.b)(o=>this.getRefreshCacheInfo(`SHEET_${this.settingsService.metadata.sheetsInfo?.UG_PATROL.label}`,this.cacheInfo).pipe((0,U.U)(n=>(this.cacheInfo=n,o))))).subscribe({next:o=>{this.fullData=o,this.initializeChartData()},error:o=>this.utilService.openErrorSnackBar(`ERROR IN FETCHING DATA: ${o}`,"Close"),complete:()=>{this.settingsService.processingText=""}})}initializeChartData(){const t={};this.fullData.forEach(o=>{const n=this.utilService.formatDate(o.Date,"DD-MMM-YY");t[n]=t[n]||0,t[n]+=o.PatrolCount}),this.chartOptions.data=[{type:this.chartType,showInLegend:!0,name:"Patrol Count",dataPoints:Object.keys(t).map(o=>({label:o,y:t[o]}))}],this.renderChart()}renderChart(){setTimeout(()=>this.chart?.render())}setChartInstance(t){this.chart=t}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["de-ug-statistics"]],features:[e.qOj],decls:18,vars:7,consts:[[1,"de-f-column","de-h-full"],[1,"filter-row","de-m-bbase"],[3,"ngModel","ngModelChange"],["value","line"],["value","spline"],["value","bar"],["value","column"],[3,"cacheInfo","refreshTriggerInterval","refresh"],[1,"de-h-full","de-w-full","de-p-tbase"],[3,"styles","options","chartInstance"],["chart",""]],template:function(o,n){1&o&&(e.TgZ(0,"section",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.qZA(),e.TgZ(5,"mat-select",2),e.NdJ("ngModelChange",function(p){return n.chartType=p})("ngModelChange",function(){return n.initializeChartData()}),e.TgZ(6,"mat-option",3),e._uU(7,"LINE"),e.qZA(),e.TgZ(8,"mat-option",4),e._uU(9,"SPLINE"),e.qZA(),e.TgZ(10,"mat-option",5),e._uU(11,"BAR"),e.qZA(),e.TgZ(12,"mat-option",6),e._uU(13,"COLUMN"),e.qZA()()()(),e.TgZ(14,"de-refresh-data",7),e.NdJ("refresh",function(){return n.refreshData(!0)}),e.qZA(),e.TgZ(15,"div",8)(16,"canvasjs-chart",9,10),e.NdJ("chartInstance",function(p){return n.setChartInstance(p)}),e.qZA()()()),2&o&&(e.xp6(4),e.Oqu(n.TKey.COMMON.CHART_TYPE),e.xp6(1),e.Q6J("ngModel",n.chartType),e.xp6(9),e.Q6J("cacheInfo",n.cacheInfo)("refreshTriggerInterval",1440),e.xp6(2),e.Q6J("styles",e.DdM(6,ae))("options",n.chartOptions))},dependencies:[Z.s,c.JJ,c.On,re.xC,f.ey,d.KE,d.hX,y.gD],styles:["[_nghost-%COMP%]{display:block;padding:12px;height:100%;width:100%}","mat-table[_ngcontent-%COMP%]     mat-header-row mat-header-cell:last-child, mat-table[_ngcontent-%COMP%]     mat-row mat-cell:last-child{max-width:90px;min-width:90px}.select-all[_ngcontent-%COMP%]{padding:6px}"]})}return i})();var R=a(1896),M=a(3305);function se(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return n.searchText="",e.KtG(n.onFilterChange())}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function ce(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.routeFilter.onSelectionChange())}),e._uU(1),e.qZA()}if(2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function _e(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.typeFilter.onSelectionChange())}),e._uU(1),e.qZA()}if(2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function de(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.createRecord())}),e.TgZ(1,"mat-icon"),e._uU(2,"add"),e.qZA(),e._uU(3),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(t.TKey.COMMON.ADD)}}function pe(i,l){if(1&i&&(e.TgZ(0,"mat-header-cell",22),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("ngClass","de-f-justifycenter"),e.xp6(1),e.Oqu("ACTIONS"===t?"":t)}}function ue(i,l){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.getBreakTimeStr())}}function ge(i,l){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.getRestoreTimeStr())}}function me(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-icon",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.editRecord(n))}),e._uU(2,"edit"),e.qZA(),e.TgZ(3,"mat-icon",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2).$implicit,r=e.oxw(2);return e.KtG(r.recordToDelete=n)}),e._uU(4,"delete"),e.qZA(),e.BQk()}}function he(i,l){if(1&i&&(e.ynx(0),e.YNc(1,me,5,0,"ng-container",27),e.BQk()),2&i){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",(null==t?null:t.ID)&&(o.authService.isUGAdmin()||o.isRecordByLoggedInUser(t)))}}function Te(i,l){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit,o=e.oxw().$implicit;e.xp6(1),e.Oqu(t[o])}}function Ce(i,l){if(1&i&&(e.TgZ(0,"mat-cell",23),e.ynx(1,24),e.YNc(2,ue,2,1,"ng-container",25),e.YNc(3,ge,2,1,"ng-container",25),e.YNc(4,he,2,1,"ng-container",25),e.YNc(5,Te,2,1,"ng-container",26),e.BQk(),e.qZA()),2&i){const t=l.$implicit,o=e.oxw().$implicit,n=e.oxw();e.Q6J("ngClass",n.getCellClassNames(t,o)),e.xp6(1),e.Q6J("ngSwitch",o),e.xp6(1),e.Q6J("ngSwitchCase",null==n.ugWorkColumns||null==n.ugWorkColumns.BREAK_TIME?null:n.ugWorkColumns.BREAK_TIME.label),e.xp6(1),e.Q6J("ngSwitchCase",null==n.ugWorkColumns||null==n.ugWorkColumns.RESTORE_TIME?null:n.ugWorkColumns.RESTORE_TIME.label),e.xp6(1),e.Q6J("ngSwitchCase","ACTIONS")}}function fe(i,l){1&i&&(e.ynx(0,19),e.YNc(1,pe,2,2,"mat-header-cell",20),e.YNc(2,Ce,6,5,"mat-cell",21),e.BQk()),2&i&&e.s9C("matColumnDef",l.$implicit)}function xe(i,l){1&i&&e._UZ(0,"mat-header-row")}function Me(i,l){1&i&&e._UZ(0,"mat-row")}function Oe(i,l){if(1&i&&(e.TgZ(0,"mat-option",45),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Ue(i,l){if(1&i&&(e.TgZ(0,"mat-option",45),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Ae(i,l){if(1&i&&(e.TgZ(0,"mat-option",45),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Ze(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"de-dialog",30),e.NdJ("closeDialog",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.recordToEdit=null)}),e.ynx(1,31),e._uU(2),e.BQk(),e.ynx(3,32),e._UZ(4,"div",33),e.TgZ(5,"mat-form-field")(6,"mat-label"),e._uU(7),e.qZA(),e.TgZ(8,"mat-select",34),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Type=n)}),e.YNc(9,Oe,2,2,"mat-option",35),e.qZA()(),e.TgZ(10,"mat-form-field")(11,"mat-label"),e._uU(12),e.qZA(),e.TgZ(13,"input",36),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.BreakTime=n)}),e.ALo(14,"date"),e.qZA()(),e.TgZ(15,"mat-form-field")(16,"mat-label"),e._uU(17),e.qZA(),e.TgZ(18,"input",36),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.RestoreTime=n)}),e.ALo(19,"date"),e.qZA()(),e.TgZ(20,"mat-form-field")(21,"mat-label"),e._uU(22),e.qZA(),e.TgZ(23,"textarea",37),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Remarks=n)}),e.qZA()(),e.TgZ(24,"mat-accordion",38)(25,"mat-expansion-panel")(26,"mat-expansion-panel-header")(27,"mat-panel-title"),e._uU(28),e.qZA()(),e.TgZ(29,"de-autocomplete",39),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Exchange=n)}),e.qZA(),e.TgZ(30,"de-autocomplete",39),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.RouteName=n)}),e.qZA(),e.TgZ(31,"de-autocomplete",39),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.WorkLocation=n)}),e.qZA(),e.TgZ(32,"mat-form-field")(33,"mat-label"),e._uU(34),e.qZA(),e.TgZ(35,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.DistanceFromExchange_km=n)}),e.qZA()()(),e.TgZ(36,"mat-expansion-panel")(37,"mat-expansion-panel-header")(38,"mat-panel-title"),e._uU(39),e.qZA()(),e.TgZ(40,"mat-form-field")(41,"mat-label"),e._uU(42),e.qZA(),e.TgZ(43,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Trenching_m=n)}),e.qZA()(),e.TgZ(44,"mat-form-field")(45,"mat-label"),e._uU(46),e.qZA(),e.TgZ(47,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.TestPit=n)}),e.qZA()(),e.TgZ(48,"mat-form-field")(49,"mat-label"),e._uU(50),e.qZA(),e.TgZ(51,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.PLB_m=n)}),e.qZA()(),e.TgZ(52,"mat-form-field")(53,"mat-label"),e._uU(54),e.qZA(),e.TgZ(55,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.CablePulling_m=n)}),e.qZA()(),e.TgZ(56,"mat-form-field")(57,"mat-label"),e._uU(58),e.qZA(),e.TgZ(59,"mat-select",34),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.UsedCableCapacity=n)}),e.YNc(60,Ue,2,2,"mat-option",35),e.qZA()(),e.TgZ(61,"mat-form-field")(62,"mat-label"),e._uU(63),e.qZA(),e.TgZ(64,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Splicing_4F6F=n)}),e.qZA()(),e.TgZ(65,"mat-form-field")(66,"mat-label"),e._uU(67),e.qZA(),e.TgZ(68,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Splicing_12F24F=n)}),e.qZA()(),e.TgZ(69,"mat-form-field")(70,"mat-label"),e._uU(71),e.qZA(),e.TgZ(72,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Splicing_48F96F=n)}),e.qZA()(),e.TgZ(73,"mat-form-field")(74,"mat-label"),e._uU(75),e.qZA(),e.TgZ(76,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Splicing_144F=n)}),e.qZA()(),e.TgZ(77,"mat-form-field")(78,"mat-label"),e._uU(79),e.qZA(),e.TgZ(80,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.Splicing288F=n)}),e.qZA()()(),e.TgZ(81,"mat-expansion-panel")(82,"mat-expansion-panel-header")(83,"mat-panel-title"),e._uU(84),e.qZA()(),e.TgZ(85,"mat-form-field")(86,"mat-label"),e._uU(87),e.qZA(),e.TgZ(88,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.ChamberInstalled=n)}),e.qZA()(),e.TgZ(89,"mat-form-field")(90,"mat-label"),e._uU(91),e.qZA(),e.TgZ(92,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OpeningOfManHoleCovers=n)}),e.qZA()(),e.TgZ(93,"mat-form-field")(94,"mat-label"),e._uU(95),e.qZA(),e.TgZ(96,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.DewateringOfChambers=n)}),e.qZA()(),e.TgZ(97,"mat-form-field")(98,"mat-label"),e._uU(99),e.qZA(),e.TgZ(100,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OpeningAndClosingOfRingManHoles=n)}),e.qZA()(),e.TgZ(101,"mat-form-field")(102,"mat-label"),e._uU(103),e.qZA(),e.TgZ(104,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.NoOfPolesInstalled=n)}),e.qZA()(),e.TgZ(105,"mat-form-field")(106,"mat-label"),e._uU(107),e.qZA(),e.TgZ(108,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableUsed_m=n)}),e.qZA()(),e.TgZ(109,"mat-form-field")(110,"mat-label"),e._uU(111),e.qZA(),e.TgZ(112,"mat-select",34),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableCapacity=n)}),e.YNc(113,Ae,2,2,"mat-option",35),e.qZA()(),e.TgZ(114,"mat-form-field")(115,"mat-label"),e._uU(116),e.qZA(),e.TgZ(117,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableSplicing_4F6F=n)}),e.qZA()(),e.TgZ(118,"mat-form-field")(119,"mat-label"),e._uU(120),e.qZA(),e.TgZ(121,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableSplicing_12F24F=n)}),e.qZA()(),e.TgZ(122,"mat-form-field")(123,"mat-label"),e._uU(124),e.qZA(),e.TgZ(125,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableSplicing_48F96F=n)}),e.qZA()(),e.TgZ(126,"mat-form-field")(127,"mat-label"),e._uU(128),e.qZA(),e.TgZ(129,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableSplicing_144F=n)}),e.qZA()(),e.TgZ(130,"mat-form-field")(131,"mat-label"),e._uU(132),e.qZA(),e.TgZ(133,"input",40),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.recordToEdit.OverheadCableSplicing_288F=n)}),e.qZA()()()(),e.BQk(),e.ynx(134,41),e.TgZ(135,"button",42),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.recordToEdit=null)}),e.TgZ(136,"mat-icon"),e._uU(137,"close"),e.qZA(),e._uU(138),e.qZA(),e.TgZ(139,"button",43),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.updateRecord())}),e.TgZ(140,"div",44)(141,"mat-icon"),e._uU(142,"save"),e.qZA(),e.TgZ(143,"span"),e._uU(144),e.qZA()()(),e.BQk(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.recordToEdit.ID?t.TKey.UG.EDIT_PATROL:t.TKey.UG.ADD_PATROL),e.xp6(5),e.Oqu(t.TKey.COMMON.TYPE),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Type),e.xp6(1),e.Q6J("ngForOf",t.options.type),e.xp6(3),e.Oqu(t.TKey.UG.BREAK_TIME),e.xp6(1),e.Q6J("ngModel",e.xi3(14,72,t.recordToEdit.BreakTime,"yyyy-MM-ddTHH:mm")),e.xp6(4),e.Oqu(t.TKey.UG.RESTORE_TIME),e.xp6(1),e.Q6J("ngModel",e.xi3(19,75,t.recordToEdit.RestoreTime,"yyyy-MM-ddTHH:mm")),e.xp6(4),e.Oqu(t.TKey.COMMON.REMARKS),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Remarks),e.xp6(5),e.Oqu(t.TKey.UG.SITE_DETAILS),e.xp6(1),e.Q6J("label",t.TKey.COMMON.EXCHANGE)("ngModel",t.recordToEdit.Exchange)("options",t.options.exchange),e.xp6(1),e.Q6J("label",t.TKey.COMMON.ROUTE)("ngModel",t.recordToEdit.RouteName)("options",t.options.routeName),e.xp6(1),e.Q6J("label",t.TKey.UG.WORK_LOCATION)("ngModel",t.recordToEdit.WorkLocation)("options",t.options.workLocation),e.xp6(3),e.Oqu(t.TKey.UG.DISTANCE_FROM_EXCHANGE),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.DistanceFromExchange_km),e.xp6(4),e.Oqu(t.TKey.UG.WORK_DETAILS),e.xp6(3),e.Oqu(t.TKey.UG.TRENCHING),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Trenching_m),e.xp6(3),e.Oqu(t.TKey.UG.TEST_PIT),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.TestPit),e.xp6(3),e.Oqu(t.TKey.UG.PLB),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.PLB_m),e.xp6(3),e.Oqu(t.TKey.UG.CABLE_PULLING),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.CablePulling_m),e.xp6(3),e.Oqu(t.TKey.UG.USED_CABLE_CAPACITY),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.UsedCableCapacity),e.xp6(1),e.Q6J("ngForOf",t.options.cableCapacity),e.xp6(3),e.Oqu(t.TKey.UG.SPLICING_4F6F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Splicing_4F6F),e.xp6(3),e.Oqu(t.TKey.UG.SPLICING_12F24F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Splicing_12F24F),e.xp6(3),e.Oqu(t.TKey.UG.SPLICING_48F96F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Splicing_48F96F),e.xp6(3),e.Oqu(t.TKey.UG.SPLICING_144F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Splicing_144F),e.xp6(3),e.Oqu(t.TKey.UG.SPLICING_288F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.Splicing288F),e.xp6(4),e.Oqu(t.TKey.UG.ADDITIONAL_WORK_DETAILS),e.xp6(3),e.Oqu(t.TKey.UG.CHAMBERS_INSTALLED),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.ChamberInstalled),e.xp6(3),e.Oqu(t.TKey.UG.OPENING_OF_MANHOLE_COVERS),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OpeningOfManHoleCovers),e.xp6(3),e.Oqu(t.TKey.UG.DEWATERING_OF_CHAMBERS),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.DewateringOfChambers),e.xp6(3),e.Oqu(t.TKey.UG.OPENING_AND_CLOSING_OF_RING_MANHOLES),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OpeningAndClosingOfRingManHoles),e.xp6(3),e.Oqu(t.TKey.UG.NO_OF_POLES_INSTALLED),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.NoOfPolesInstalled),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_CABLE_USED),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableUsed_m),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_CABLE_CAPACITY),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableCapacity),e.xp6(1),e.Q6J("ngForOf",t.options.cableCapacity),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_SPLICING_4F6F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableSplicing_4F6F),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_SPLICING_12F24F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableSplicing_12F24F),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_SPLICING_48F96F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableSplicing_48F96F),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_SPLICING_144F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableSplicing_144F),e.xp6(3),e.Oqu(t.TKey.UG.OVERHEAD_SPLICING_288F),e.xp6(1),e.Q6J("ngModel",t.recordToEdit.OverheadCableSplicing_288F),e.xp6(5),e.Oqu(t.TKey.COMMON.CANCEL),e.xp6(6),e.Oqu(t.TKey.COMMON.SAVE)}}function Ge(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"de-confirmation-dialog",46),e.NdJ("onSuccess",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.deleteRecord())})("onCancel",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.recordToDelete=null)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("title","Delete Patrol?")("content","Are you sure you want to delete patrol '"+t.recordToDelete.RouteName+"'?")}}const I=function(){return{standalone:!0}},ye=function(){return[25,50,100,150]};class h extends C.H6{constructor(){super(),this.data=new s.by([]),this.fullData=[],this.ugWorkColumns=this.settingsService.metadata.sheetsInfo?.UG_WORK?.cols,this.allColumns=[this.ugWorkColumns?.BREAK_TIME?.label||"",this.ugWorkColumns?.RESTORE_TIME?.label||"",this.ugWorkColumns?.ROUTE_NAME?.label||"",this.ugWorkColumns?.TYPE?.label||"",this.ugWorkColumns?.REMARKS?.label||""],this.displayedColumns=[],this.displayedColumnsWithAction=[],this.searchText="",this.searchTextRegexp=new RegExp(""),this.routeFilter=this.getNewFilterControl([],[]),this.typeFilter=this.getNewFilterControl([],[]),this.recordToEdit=null,this.recordToDelete=null,this.options={exchange:[],routeName:[],cableCapacity:[],type:[],workLocation:[]},this.cacheInfo=null,this.filterType=this.filterType.bind(this),this.filterRouteName=this.filterRouteName.bind(this),this.filterSearch=this.filterSearch.bind(this),this._subscriptions.push(this.eventService.isMobile.subscribe(()=>this.refreshDisplayedColumns())),this.settingsService.pageTitle=this.TKey.UG.WORK_LIST}ngOnInit(){this._subscriptions.push(this.eventService.isMobile.subscribe(()=>this.refreshDisplayedColumns()))}ngAfterViewInit(){this.data.sort=this.sort,this.data.paginator=this.paginator,this.refreshData()}refreshDisplayedColumns(){this.displayedColumns=this.settingsService.isMobile?[this.allColumns[0],this.allColumns[2],this.allColumns[3]]:this.allColumns.slice(),this.displayedColumnsWithAction=[...this.displayedColumns,"ACTIONS"]}refreshData(l=!1){this.settingsService.processingText="Refreshing data...",this.apiGSheetDataService.getSheetData(this.settingsService.metadata.sheetsInfo?.UG_WORK.label,g.q_,l).pipe((0,O.b)(t=>this.getRefreshCacheInfo(`SHEET_${this.settingsService.metadata.sheetsInfo?.UG_WORK.label}`,this.cacheInfo).pipe((0,U.U)(o=>(this.cacheInfo=o,t))))).subscribe({next:t=>{console.log(t),this.fullData=t,this.options.type=Object.values(this.settingsService.metadata.sheetsInfo?.UG_WORK.cols.TYPE.data||{}),this.options.cableCapacity=Object.values(this.settingsService.metadata.sheetsInfo?.UG_WORK.cols.USED_CABLE_CAPACITY.data||{}),this.options.exchange=Object.keys(this.fullData.reduce((o,n)=>(o[n.Exchange]=!0,o),{})),this.options.routeName=Object.keys(this.fullData.reduce((o,n)=>(o[n.RouteName]=!0,o),{})),this.options.workLocation=Object.keys(this.fullData.reduce((o,n)=>(o[n.WorkLocation]=!0,o),{})),this.options.exchange.sort(),this.options.routeName.sort(),this.options.workLocation.sort(),this.initializeFilters()},error:t=>this.utilService.openErrorSnackBar(`ERROR IN FETCHING DATA: ${t}`,"Close"),complete:()=>{this.recordToEdit=null,this.recordToDelete=null,this.settingsService.processingText=""}})}createRecord(){this.recordToEdit=new g.q_({Date:new Date,PatrolCount:1})}editRecord(l){this.recordToEdit=l.clone()}updateRecord(){if(!this.recordToEdit)return;this.settingsService.processingText="Updating data...";const l=this.recordToEdit.clone(),t=!l.ID;l.ID=l.ID||Date.now().toString(),l.BreakTime=l.getBreakTimeStr(),l.RestoreTime=l.getRestoreTimeStr(),t&&(l.By=this.authService.Username),this.apiGSheetDataService.saveOrUpdateRecord(this.settingsService.metadata.sheetsInfo?.UG_WORK?.label,[this.ugWorkColumns?.ID?.label],l).subscribe({next:()=>{this.settingsService.processingText="",this.refreshData(!0)},error:o=>{this.settingsService.processingText="",this.utilService.openErrorSnackBar(o,"Close")}})}deleteRecord(){this.settingsService.processingText="Deleting record...",this.apiGSheetDataService.deleteRecord(this.settingsService.metadata.sheetsInfo?.UG_WORK?.label,[this.ugWorkColumns?.ID?.label],this.recordToDelete).subscribe({next:()=>{this.settingsService.processingText="",this.refreshData(!0)},error:l=>{this.settingsService.processingText="",this.utilService.openErrorSnackBar(l,"Close")}})}initializeFilters(){const l={};this.fullData.forEach(t=>{l[t.RouteName]=!0}),this.routeFilter.controlOptions=Object.keys(l),this.routeFilter.controlOptions.sort(),this.routeFilter.control.setValue([]),this.routeFilter.selectAll=!1,this.typeFilter.controlOptions=Object.values(this.settingsService.metadata.sheetsInfo?.UG_WORK.cols.TYPE.data||{}),this.typeFilter.controlOptions.sort(),this.typeFilter.control.setValue([]),this.typeFilter.selectAll=!1,this.onFilterChange()}onFilterChange(){const l=r=>!0;let t=this.filterType,o=this.filterRouteName,n=this.filterSearch;this.routeFilter._selectedObj={},(this.routeFilter.control.value||[]).forEach(r=>this.routeFilter._selectedObj[r]=!0),this.typeFilter._selectedObj={},(this.typeFilter.control.value||[]).forEach(r=>this.typeFilter._selectedObj[r]=!0),(!this.routeFilter.control.value?.length||(this.routeFilter.control?.value||[]).length===this.routeFilter.controlOptions?.length)&&(o=l),(!this.typeFilter.control.value?.length||(this.typeFilter.control?.value||[]).length===this.typeFilter.controlOptions?.length)&&(t=l),this.searchText?this.searchTextRegexp=this.utilService.getFlexibleSearchTextRegexp(this.searchText):n=l,this.data.data=this.fullData.filter(o).filter(t).filter(n)}filterSearch(l){return l.freeTextSearch(this.searchTextRegexp)}filterRouteName(l){return this.routeFilter._selectedObj[l.RouteName]}filterType(l){return this.typeFilter._selectedObj[l.Type]}getCellClassNames(l,t){return t===this.ugWorkColumns?.TYPE.label||"ACTIONS"===t?"align-center":""}isRecordByLoggedInUser(l){return l.By===this.authService.Username}static#e=this.\u0275fac=function(t){return new(t||h)};static#t=this.\u0275cmp=e.Xpm({type:h,selectors:[["de-ug-work-list"]],viewQuery:function(t,o){if(1&t&&(e.Gf(u.YE,5),e.Gf(T.NW,5)),2&t){let n;e.iGM(n=e.CRH())&&(o.sort=n.first),e.iGM(n=e.CRH())&&(o.paginator=n.first)}},features:[e.qOj],decls:31,vars:26,consts:[[1,"filter-row","de-p-vbase"],["matInput","","type","text",3,"ngModel","ngModelChange"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],["multiple","",3,"formControl"],[1,"select-all"],[3,"ngModel","ngModelOptions","ngModelChange","change"],[3,"value","click",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"de-m-bbase",3,"cacheInfo","refresh"],["matSort","","matSortActive","BreakTime","matSortDirection","desc",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],[4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["pageSize","50","showFirstLastButtons","",3,"pageSizeOptions"],["classNames","min-w300",3,"closeDialog",4,"ngIf"],[3,"title","content","onSuccess","onCancel",4,"ngIf"],["matSuffix","","mat-icon-button","",3,"click"],[3,"value","click"],["mat-raised-button","","color","accent",3,"click"],[3,"matColumnDef"],["mat-sort-header","",3,"ngClass",4,"matHeaderCellDef"],[3,"ngClass",4,"matCellDef"],["mat-sort-header","",3,"ngClass"],[3,"ngClass"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[4,"ngIf"],["color","primary",1,"de-cursorpointer","de-m-rbase",3,"click"],["color","warn",1,"de-cursorpointer",3,"click"],["classNames","min-w300",3,"closeDialog"],["de-dialog-header",""],["de-dialog-body",""],[1,"de-p-vbase"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","datetime-local",3,"ngModel","ngModelChange"],["matInput","",3,"ngModel","ngModelChange"],["multi","",1,"example-headers-align"],[3,"label","ngModel","options","ngModelChange"],["matInput","","type","number",3,"ngModel","ngModelChange"],["de-dialog-footer",""],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"de-f-aligncenter","de-sm-rsmall-nolast"],[3,"value"],[3,"title","content","onSuccess","onCancel"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-form-field")(2,"mat-label"),e._uU(3),e.qZA(),e.TgZ(4,"input",1),e.NdJ("ngModelChange",function(r){return o.searchText=r})("ngModelChange",function(){return o.onFilterChange()}),e.qZA(),e.YNc(5,se,3,0,"button",2),e.qZA(),e.TgZ(6,"mat-form-field")(7,"mat-label"),e._uU(8),e.qZA(),e.TgZ(9,"mat-select",3)(10,"div",4)(11,"mat-checkbox",5),e.NdJ("ngModelChange",function(r){return o.routeFilter.selectAll=r})("change",function(){return o.routeFilter.toggleSelectAll()}),e._uU(12,"Select All"),e.qZA()(),e.YNc(13,ce,2,2,"mat-option",6),e.qZA()(),e.TgZ(14,"mat-form-field")(15,"mat-label"),e._uU(16),e.qZA(),e.TgZ(17,"mat-select",3)(18,"div",4)(19,"mat-checkbox",5),e.NdJ("ngModelChange",function(r){return o.typeFilter.selectAll=r})("change",function(){return o.typeFilter.toggleSelectAll()}),e._uU(20,"Select All"),e.qZA()(),e.YNc(21,_e,2,2,"mat-option",6),e.qZA()(),e.YNc(22,de,4,1,"button",7),e.qZA(),e.TgZ(23,"de-refresh-data",8),e.NdJ("refresh",function(){return o.refreshData(!0)}),e.qZA(),e.TgZ(24,"mat-table",9),e.YNc(25,fe,3,1,"ng-container",10),e.YNc(26,xe,1,0,"mat-header-row",11),e.YNc(27,Me,1,0,"mat-row",12),e.qZA(),e._UZ(28,"mat-paginator",13),e.YNc(29,Ze,145,78,"de-dialog",14),e.YNc(30,Ge,1,2,"de-confirmation-dialog",15)),2&t&&(e.xp6(3),e.Oqu(o.TKey.COMMON.SEARCH),e.xp6(1),e.Q6J("ngModel",o.searchText),e.xp6(1),e.Q6J("ngIf",o.searchText),e.xp6(3),e.Oqu(o.TKey.COMMON.ROUTE),e.xp6(1),e.Q6J("formControl",o.routeFilter.control),e.xp6(2),e.Q6J("ngModel",o.routeFilter.selectAll)("ngModelOptions",e.DdM(23,I)),e.xp6(2),e.Q6J("ngForOf",o.routeFilter.controlOptions),e.xp6(3),e.Oqu(o.TKey.COMMON.TYPE),e.xp6(1),e.Q6J("formControl",o.typeFilter.control),e.xp6(2),e.Q6J("ngModel",o.typeFilter.selectAll)("ngModelOptions",e.DdM(24,I)),e.xp6(2),e.Q6J("ngForOf",o.typeFilter.controlOptions),e.xp6(1),e.Q6J("ngIf",o.settingsService.isOnline),e.xp6(1),e.Q6J("cacheInfo",o.cacheInfo),e.xp6(1),e.Q6J("dataSource",o.data),e.xp6(1),e.Q6J("ngForOf",o.displayedColumnsWithAction),e.xp6(1),e.Q6J("matHeaderRowDef",o.displayedColumnsWithAction)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumnsWithAction),e.xp6(1),e.Q6J("pageSizeOptions",e.DdM(25,ye)),e.xp6(1),e.Q6J("ngIf",o.recordToEdit),e.xp6(1),e.Q6J("ngIf",o.recordToDelete))},dependencies:[N,F.z,v.a,Z.s,_.mk,_.sg,_.O5,_.RF,_.n9,_.ED,c.Fj,c.wV,c.JJ,c.On,c.oH,f.ey,x.lW,x.RK,w.oG,M.pp,M.ib,M.yz,M.yK,d.KE,d.hX,d.R9,D.Hw,A.Nt,u.YE,u.nU,T.NW,y.gD,s.BZ,s.fO,s.as,s.w1,s.Dz,s.nj,s.ge,s.ev,s.XQ,s.Gk,_.uU],styles:["[_nghost-%COMP%]{display:block;padding:12px;height:100%;width:100%}","mat-table[_ngcontent-%COMP%]     mat-header-row mat-header-cell:last-child, mat-table[_ngcontent-%COMP%]     mat-row mat-cell:last-child{max-width:90px;min-width:90px}.select-all[_ngcontent-%COMP%]{padding:6px}th.mat-sort-header-sorted[_ngcontent-%COMP%]{color:#000}"]})}(0,E.gn)([(0,S.Ds)(500)],h.prototype,"onFilterChange",null);const be=[{path:"patrol-list",component:m},{path:"work-list",component:h},{path:"patrol-statistics",component:J},{path:"**",redirectTo:"patrol-list"}];let K=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[R.Bz.forChild(be),R.Bz]})}return i})();a(8313);let Ee=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[C.nC.forChild(),K]})}return i})()}}]);